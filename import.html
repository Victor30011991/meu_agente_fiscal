<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>FluxoPro – Importação</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<!-- CSS original mantido -->
</head>
<body>

<!-- HTML estrutural mantido -->

<script>
const KEY = "fluxopro_v12";

const params = new URLSearchParams(window.location.search);
let perfil = params.get("perfil");

let buffer = [];
let ignored = [];
let db;

try {
  const raw = localStorage.getItem(KEY);
  if(!raw) throw new Error("Base não encontrada.");

  db = JSON.parse(raw);

  if(!db || !db.profiles){
    throw new Error("Base de dados não encontrada. Abra o FluxoPro primeiro.");
  }

  if(!perfil){
    perfil = db.active;
  }

  if(!perfil || !db.profiles[perfil]){
    throw new Error(`Perfil "${perfil}" não encontrado.`);
  }

  perfilNome.innerText = perfil;

} catch(err) {
  document.querySelector('.container').innerHTML = `
    <div class="card">
      <h2>⚠️ Erro</h2>
      <div class="status error">${err.message}</div>
      <button onclick="window.close()">Fechar janela</button>
    </div>
  `;
  throw err;
}

/* restante do código permanece igual ao seu */

</script>

</body>
</html>
