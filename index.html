<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>FluxoPro</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#f5f7fb;
  --card:#ffffff;
  --text:#1f2937;
  --primary:#2563eb;
}

[data-theme="dark"]{
  --bg:#0f172a;
  --card:#020617;
  --text:#e5e7eb;
  --primary:#60a5fa;
}

body{
  margin:0;
  font-family:Inter;
  background:var(--bg);
  color:var(--text);
}

header{
  padding:16px 24px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:var(--card);
}

main{
  max-width:1100px;
  margin:auto;
  padding:24px;
}

.card{
  background:var(--card);
  border-radius:14px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 8px 20px rgba(0,0,0,.05);
}

button,select,input{
  padding:8px 12px;
  border-radius:8px;
  border:1px solid #ccc;
  font-family:Inter;
}

button{
  background:var(--primary);
  color:#fff;
  border:0;
  cursor:pointer;
  font-weight:600;
}

table{
  width:100%;
  border-collapse:collapse;
}

th,td{
  padding:8px;
  border-bottom:1px solid #ddd;
  font-size:14px;
}

.flex{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

small{opacity:.7}
</style>
</head>

<body>

<header>
  <b>FluxoPro</b>

  <div class="flex">
    <select id="perfilSelect"></select>
    <button onclick="novoPerfil()">Novo perfil</button>
    <button onclick="alternarTema()">Tema</button>
  </div>
</header>

<main>

<div class="card">
  <h3>Dashboard</h3>

  <div class="flex">
    <div>Entradas: <b id="dEnt"></b></div>
    <div>Saídas: <b id="dSai"></b></div>
    <div>Resultado: <b id="dRes"></b></div>
  </div>

  <br>

  <div class="flex">
    <button onclick="abrirExport()">Exportar</button>
    <button onclick="abrirImport()">Importar</button>
  </div>
</div>

<div class="card">
  <h3>Novo lançamento</h3>

  <div class="flex">
    <input type="date" id="data">
    <input placeholder="Categoria" id="cat">
    <select id="tipo">
      <option>Entrada</option>
      <option>Saída</option>
    </select>
    <input placeholder="Valor" id="valor">
    <input placeholder="Observação" id="obs">
    <button onclick="salvar()">Salvar</button>
  </div>
</div>

<div class="card">
  <h3>Lançamentos</h3>

  <table>
    <thead>
      <tr>
        <th>Data</th>
        <th>Categoria</th>
        <th>Tipo</th>
        <th>Valor</th>
        <th>Obs</th>
        <th></th>
      </tr>
    </thead>
    <tbody id="tb"></tbody>
  </table>
</div>

</main>

<script>
const KEY = "fluxopro_v11";
const THEME_KEY = "fluxopro_theme";

/* =========================
   Inicialização
========================= */

let db = JSON.parse(localStorage.getItem(KEY));

if(!db){
  db = {
    active: "Principal",
    profiles: {
      "Principal":[]
    },
    profileInfo:{}
  };
  localStorage.setItem(KEY,JSON.stringify(db));
}

let perfilAtivo = db.active;

/* =========================
   Tema
========================= */

function carregarTema(){
  const t = localStorage.getItem(THEME_KEY) || "light";
  document.documentElement.setAttribute("data-theme",t);
}

function alternarTema(){
  const atual = document.documentElement.getAttribute("data-theme") || "light";
  const novo = atual === "light" ? "dark" : "light";
  document.documentElement.setAttribute("data-theme",novo);
  localStorage.setItem(THEME_KEY,novo);
}

/* =========================
   Perfis
========================= */

function renderPerfis(){

  perfilSelect.innerHTML = Object.keys(db.profiles)
    .map(p=>`<option ${p===perfilAtivo?"selected":""}>${p}</option>`)
    .join("");

}

perfilSelect.onchange = ()=>{
  perfilAtivo = perfilSelect.value;
  db.active = perfilAtivo;
  salvarDB();
  render();
};

function novoPerfil(){

  const nome = prompt("Nome do perfil:");
  if(!nome) return;

  if(db.profiles[nome]){
    alert("Perfil já existe.");
    return;
  }

  db.profiles[nome] = [];
  db.profileInfo[nome] = {};

  perfilAtivo = nome;
  db.active = nome;

  salvarDB();
  render();
}

/* =========================
   Lançamentos
========================= */

function salvar(){

  if(!data.value || !valor.value){
    alert("Preencha data e valor.");
    return;
  }

  const v = Number(
    String(valor.value)
      .replace(".","")
      .replace(",",".")
  );

  if(isNaN(v)){
    alert("Valor inválido.");
    return;
  }

  db.profiles[perfilAtivo].push({
    id: crypto.randomUUID(),
    data: data.value,
    cat: cat.value,
    tipo: tipo.value,
    valor: v,
    obs: obs.value
  });

  data.value="";
  cat.value="";
  valor.value="";
  obs.value="";

  salvarDB();
  render();
}

function excluir(id){
  db.profiles[perfilAtivo] =
    db.profiles[perfilAtivo].filter(l=>l.id!==id);

  salvarDB();
  render();
}

/* =========================
   Dashboard + tabela
========================= */

function money(v){
  return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(v||0);
}

function render(){

  renderPerfis();

  const lista = db.profiles[perfilAtivo];

  let ent=0,sai=0;

  lista.forEach(l=>{
    if(l.tipo==="Entrada") ent+=Number(l.valor)||0;
    else sai+=Number(l.valor)||0;
  });

  dEnt.innerText = money(ent);
  dSai.innerText = money(sai);
  dRes.innerText = money(ent-sai);

  tb.innerHTML = lista.map(l=>`
    <tr>
      <td>${l.data||""}</td>
      <td>${l.cat||""}</td>
      <td>${l.tipo||""}</td>
      <td>${money(l.valor)}</td>
      <td>${l.obs||""}</td>
      <td><button onclick="excluir('${l.id}')">X</button></td>
    </tr>
  `).join("");
}

/* =========================
   Exportação / Importação
========================= */

function abrirExport(){
  window.open(`export.html?perfil=${encodeURIComponent(perfilAtivo)}`);
}

function abrirImport(){
  window.open(`import.html?perfil=${encodeURIComponent(perfilAtivo)}`);
}

/* =========================
   Util
========================= */

function salvarDB(){
  localStorage.setItem(KEY,JSON.stringify(db));
}

/* =========================
   Start
========================= */

carregarTema();
render();
</script>

</body>
</html>
