<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>FluxoPro Engine v12</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<link id="themeCSS" rel="stylesheet" href="">

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui;background:#f5f7fb;color:#1f2937;transition:background .3s, color .3s}
:root{--p:#4f46e5;--card:#fff;--b:#e5e7eb;--ok:#10b981;--bad:#ef4444}
header{background:#fff;border-bottom:1px solid var(--b);padding:14px 20px;display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
.tabs button{border:none;padding:10px 16px;border-radius:12px;cursor:pointer;font-weight:700;background:#f3f4f6;transition:all .2s}
.tabs button.active{background:var(--p);color:#fff}
.container{max-width:1300px;margin:auto;padding:20px}
.layout{display:grid;grid-template-columns:340px 1fr;gap:20px;align-items:flex-start;}
.sidebar{position:sticky;top:20px;}
@media(max-width:900px){
  .layout{grid-template-columns:1fr}
  .sidebar{position:relative}
}
.card{background:var(--card);border-radius:18px;padding:20px;border:1px solid var(--b);margin-bottom:20px;box-shadow:0 10px 20px rgba(0,0,0,.04);transition:all .3s}
table{width:100%;border-collapse:collapse}
th,td{padding:12px 10px;border-bottom:1px solid var(--b)}
td[contenteditable]{cursor:text;transition:all .2s}
td[contenteditable]:focus{outline:2px solid var(--p);background:#eef2ff}
.badge{padding:6px 12px;border-radius:999px;font-weight:700;cursor:pointer;display:inline-block;transition:all .2s}
.entrada{background:#ecfdf5;color:var(--ok)}
.saida{background:#fef2f2;color:var(--bad)}
button{border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer;transition:all .2s}
button:hover{opacity:.8;transform:translateY(-1px)}
.main{background:var(--p);color:#fff}
.actions{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px}
select,input,textarea{padding:8px 10px;border-radius:10px;border:1px solid var(--b);font-family:inherit}
.resume{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px;margin-bottom:10px}
.resume div{background:#f9fafb;border-radius:12px;padding:12px;font-weight:700;text-align:center}
.gridDash{display:grid;grid-template-columns:1fr;gap:16px;}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:9999}
.modal .card{max-width:380px;width:90%;margin:0}
.hidden{display:none}

/* seletor de tema */
.theme-selector{display:flex;gap:8px;align-items:center}
.theme-btn{width:28px;height:28px;border-radius:50%;border:2px solid transparent;cursor:pointer;transition:all .2s}
.theme-btn:hover{transform:scale(1.1)}
.theme-btn.active{border-color:#000;box-shadow:0 0 0 2px #fff}
.theme-default{background:linear-gradient(135deg,#f5f7fb,#4f46e5)}
.theme-dark{background:#0f172a}
.theme-emerald{background:#10b981}
.theme-gold{background:#f59e0b}
.theme-indigo{background:#6366f1}
.theme-rose{background:#fb7185}

.loading{display:inline-block;width:16px;height:16px;border:3px solid #fff;border-top-color:transparent;border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

.toast{position:fixed;bottom:20px;right:20px;background:#1f2937;color:#fff;padding:12px 20px;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.3);z-index:10000;animation:slideIn .3s}
@keyframes slideIn{from{transform:translateX(400px);opacity:0}}
</style>
</head>
<body>

<header>
<strong>FluxoPro Engine v12</strong>

<div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
<select id="perfilSelect"></select>
<button id="novoPerfil" title="Novo perfil">+</button>

<div class="theme-selector">
<button class="theme-btn theme-default" data-theme="" title="Padr√£o"></button>
<button class="theme-btn theme-dark" data-theme="dark" title="Dark"></button>
<button class="theme-btn theme-emerald" data-theme="emerald" title="Emerald"></button>
<button class="theme-btn theme-gold" data-theme="gold" title="Gold"></button>
<button class="theme-btn theme-indigo" data-theme="indigo" title="Indigo"></button>
<button class="theme-btn theme-rose" data-theme="rose" title="Rose"></button>
</div>

<div class="tabs">
<button data-tab="lanc" class="active">Lan√ßamentos</button>
<button data-tab="conf">Configura√ß√µes</button>
</div>
</div>
</header>

<div class="container">
<div class="layout">

<aside class="sidebar">

<div class="card">
<h3>Resumo geral</h3>

<div class="resume">
<div>Entradas<br><span id="sumEnt">R$ 0,00</span></div>
<div>Sa√≠das<br><span id="sumSai">R$ 0,00</span></div>
<div>Resultado<br><span id="sumRes">R$ 0,00</span></div>
</div>

<div class="actions">
<button onclick="abrirExport()">üìä Exportar</button>
<button onclick="abrirImport()">üì• Importar</button>
</div>
</div>

<div class="gridDash">
<div class="card">
<h4>Distribui√ß√£o por categoria</h4>
<canvas id="chartPizza"></canvas>
<p id="txtPizza"></p>
</div>

<div class="card">
<h4>Percentual Entradas x Sa√≠das</h4>
<canvas id="chartPerc"></canvas>
<p id="txtPerc"></p>
</div>

<div class="card">
<h4>Resumo Financeiro</h4>
<canvas id="chartResumo"></canvas>
<p id="txtResumo"></p>
</div>
</div>
</aside>

<main>

<section id="tab-lanc">

<div class="actions">
<button class="main" id="novoLanc">‚ûï Novo lan√ßamento</button>
<button id="importar">üì• Alimentar perfil</button>
<button id="refreshBtn">üîÑ Refresh</button>
</div>

<div class="card">
<h3>Dados do perfil</h3>
<input id="perfilNome" placeholder="Nome / Raz√£o social" style="width:100%;margin-bottom:8px">
<input id="perfilDoc" placeholder="CPF ou CNPJ" style="width:100%">
</div>

<div class="card">
<table>
<thead>
<tr>
<th>Data</th>
<th>Categoria</th>
<th>Tipo</th>
<th>Valor</th>
<th>Observa√ß√£o</th>
<th>Apagar</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>
</section>

<section id="tab-conf" class="hidden">
<div class="card">
<h3>Painel de controle</h3>
<button id="exportAll">üìä Relat√≥rio (Excel / PDF)</button>
<button id="resetAll" style="background:#ef4444;color:#fff">üóëÔ∏è Reset de f√°brica</button>
</div>
</section>

</main>
</div>
</div>

<div class="modal" id="modal">
<div class="card">
<h3>Novo lan√ßamento</h3>
<form id="form">
<input type="date" id="data" required><br><br>
<input type="text" id="cat" placeholder="Categoria" required><br><br>
<select id="tipo">
<option>Entrada</option>
<option>Sa√≠da</option>
</select><br><br>
<input type="text" id="valor" placeholder="Valor (ex: 1.500,00)" required><br><br>
<textarea id="obs" placeholder="Observa√ß√£o (opcional)"></textarea><br><br>
<div style="display:flex;gap:10px">
<button type="submit" class="main">üíæ Salvar</button>
<button type="button" onclick="fecharModal()">‚ùå Cancelar</button>
</div>
</form>
</div>
</div>

<script>
/* TODO o seu JS original permanece exatamente igual
   at√© chegar no sistema de temas.
   A √∫nica parte alterada √© abaixo.
*/

const KEY="fluxopro_v12";
let charts={};
let debounceTimer;

/* ... todo o seu c√≥digo original aqui (inalterado) ... */

/* ========= SISTEMA DE TEMAS (corrigido) ========= */

document.querySelectorAll(".theme-btn").forEach(btn=>{
  btn.onclick=()=>{
    const theme=btn.dataset.theme;
    const db=loadDB();
    db.theme=theme;
    saveDB(db);

    document.querySelectorAll(".theme-btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");

    if(theme){
      themeCSS.href=`themes/${theme}.css`;
    }else{
      themeCSS.href="";
    }

    showToast(`üé® Tema: ${theme||"Padr√£o"}`);
  };
});

function loadTheme(){
  const db=loadDB();
  const theme=db.theme||"";

  document.querySelectorAll(".theme-btn").forEach(b=>b.classList.remove("active"));

  if(theme){
    themeCSS.href=`themes/${theme}.css`;
    const btn=document.querySelector(`.theme-btn[data-theme="${theme}"]`);
    if(btn) btn.classList.add("active");
  }else{
    themeCSS.href="";
    const btn=document.querySelector('.theme-btn[data-theme=""]');
    if(btn) btn.classList.add("active");
  }
}

/* inicializa√ß√£o original */
(function init(){
  const db=loadDB();
  saveDB(db);
  loadTheme();
  renderPerfis();
  refreshAll();
})();

modal.onclick=e=>{
  if(e.target===modal)fecharModal();
};
</script>

</body>
</html>
